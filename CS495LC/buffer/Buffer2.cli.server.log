CMBEGIN,,,cd server.Buffer2.CS495LC.isi.deterlab.net,,
CMBEGIN,,,cd /,,
CMBEGIN,,,cd server.Buffer2.CS495LC.isi.deterlab.net,,
CMBEGIN,,,cd /usr/src/fhttpd,,
CMBEGIN,Nov 28 12:03:26,/users/lclarkfh,ls,frobnick  index.html  Makefile<HT>webserver  webserver.c,ls
CMBEGIN,Nov 28 12:06:11,/usr/src/fhttpd,sudo make,make: Nothing to be done for 'project'.,sudo make
CMBEGIN,Nov 28 12:06:26,/usr/src/fhttpd,sudo ./webserver 8080,<NL><NL>^C,sudo ./webserver 8080
CMBEGIN,Nov 28 12:06:50,/usr/src/fhttpd,sudo ./webserver 8080,^C,sudo ./webserver 8080
CMBEGIN,,,server.Buffer2.CS495LC.isi.deterlab.net,,
CMBEGIN,Nov 28 12:07:40,/usr/src/fhttpd,sudo ./webserver 8082,kdakdscalmd<NL>quit<NL>^C,sudo ./webserver 8082
CMBEGIN,Nov 28 12:07:59,/usr/src/fhttpd,ls,frobnick  index.html  Makefile<HT>webserver  webserver.c,ls
CMBEGIN,Nov 28 12:08:34,/usr/src/fhttpd,sudo make,make: Nothing to be done for 'project'.,sudo make
CMBEGIN,Nov 28 12:08:43,/usr/src/fhttpd,sudo ./webserver 8080,GET / HTTP/1.1<NL><NL>User-Agent: Wget/1.17.1 (linux-gnu)<NL><NL>Accept: */*<NL><NL>Accept-Encoding: identity<NL><NL>Host: localhost:8080<NL><NL>Connection: Keep-Alive<NL><NL><NL>GET /dnackjsdcnaskjdcnakjsdcnaskjdcnaskjdcnaskjdcnaskjdcnsdjkcnaskjdcnaskjdcnskjdcnskjdcnskjdcnaskdjcnskjdcnaskdjcsdjkcnaskdjnaskdcnsakj HTTP/1.1<NL><NL>User-Agent: Wget/1.17.1 (linux-gnu)<NL><NL>Accept: */*<NL><NL>Accept-Encoding: identity<NL><NL>Host: localhost:8080<NL><NL>Connection: Keep-Alive<NL><NL><NL>GET /index HTTP/1.1<NL><NL>User-Agent: Wget/1.17.1 (linux-gnu)<NL><NL>Accept: */*<NL><NL>Accept-Encoding: identity<NL><NL>Host: localhost:8080<NL><NL>Connection: Keep-Alive<NL><NL><NL>GET /frobnic/100 HTTP/1.1<NL><NL>User-Agent: Wget/1.17.1 (linux-gnu)<NL><NL>Accept: */*<NL><NL>Accept-Encoding: identity<NL><NL>Host: localhost:8080<NL><NL>Connection: Keep-Alive<NL><NL><NL>GET /frobnic/100 HTTP/1.1<NL><NL>User-Agent: Wget/1.17.1 (linux-gnu)<NL><NL>Accept: */*<NL><NL>Accept-Encoding: identity<NL><NL>Host: localhost:8080<NL><NL>Connection: Keep-Alive<NL><NL>,sudo ./webserver 8080
CMBEGIN,Nov 28 12:12:32,/users/lclarkfh,wget http://localhost:8080/dnackjsdcnaskjdcnakjsdcnaskjdcnaskjdcnaskjdcnaskjdcnsdjkcnaskjdcnaskjdcnskjdcnskjdcnskjdcnaskdjcnskjdcnaskdjcsdjkcnaskdjnaskdcnsakj,%--2018-11-28 12:12:32--  http://localhost:8080/dnackjsdcnaskjdcnakjsdcnaskjdcnaskjdcnaskjdcnaskjdcnsdjkcnaskjdcnaskjdcnskjdcnskjdcnskjdcnaskdjcnskjdcnaskdjcsdjkcnaskdjnaskdcnsakj<NL>Resolving localhost (localhost)... 127.0.0.1<NL>Connecting to localhost (localhost)|127.0.0.1|:8080... connected.<NL>HTTP request sent%% awaiting response... 404 Not Found<NL>2018-11-28 12:12:32 ERROR 404: Not Found.<NL>%,wget http://localhost:8080/dnackjsdcnaskjdcnakjsdcnaskjdcnaskjdcnaskjdcnaskjdcnsdjkcnaskjdcnaskjdcnskjdcnskjdcnskjdcnaskdjcnskjdcnaskdjcsdjkcnaskdjnaskdcnsakj
CMBEGIN,,,wget http://localhost:8080/dnackjsdcnaskjdcnakjsdcnaskjdcnaskjdcnaskjdcnaskjdcnsdjkcnaskjdcnaskjdcnskjdcnskjdcnskjdcnaskdjcnskjdcnaskdjcsdj,,
CMBEGIN,,,wget http://localhost:8080/dnackjsdcnaskjdcnakjsdcnaskjdcnaskjdcnaskjdcnaskjdcnsdjkcnaskjdcnaskjdcnskjdcnskjdcnskjdcnaskdjcnskjdcnaskdjcsdj,,
CMBEGIN,,,wget http://localhost:8080,,
CMBEGIN,Nov 28 12:13:16,/users/lclarkfh,wget http://localhost:8080/index,%--2018-11-28 12:13:16--  http://localhost:8080/index<NL>Resolving localhost (localhost)... 127.0.0.1<NL>Connecting to localhost (localhost)|127.0.0.1|:8080... connected.<NL>HTTP request sent%% awaiting response... 404 Not Found<NL>2018-11-28 12:13:16 ERROR 404: Not Found.<NL>%,wget http://localhost:8080/index
CMBEGIN,Nov 28 12:13:20,/users/lclarkfh,ls,index.html  lclarkfh-intro.tar.gz  top_secret,ls
CMBEGIN,Nov 28 12:13:31,/users/lclarkfh,cat index.html ,<html><NL><head><NL><title><NL><HT>Frobnick Production Reports<NL></title><NL></head><NL><body><NL><HT><h1>Frobnick Production Reports</h1><NL><HT><ul><NL><li><a href='frobnick/1.frob.txt'>1.frob.txt</a></li><NL><li><a href='frobnick/2.frob.txt'>2.frob.txt</a></li><NL><li><a href='frobnick/3.frob.txt'>3.frob.txt</a></li><NL><li><a href='frobnick/4.frob.txt'>4.frob.txt</a></li><NL><li><a href='frobnick/5.frob.txt'>5.frob.txt</a></li><NL><li><a href='frobnick/6.frob.txt'>6.frob.txt</a></li><NL><li><a href='frobnick/7.frob.txt'>7.frob.txt</a></li><NL><li><a href='frobnick/8.frob.txt'>8.frob.txt</a></li><NL><li><a href='frobnick/9.frob.txt'>9.frob.txt</a></li><NL><li><a href='frobnick/10.frob.txt'>10.frob.txt</a></li><NL><li><a href='frobnick/11.frob.txt'>11.frob.txt</a></li><NL><li><a href='frobnick/12.frob.txt'>12.frob.txt</a></li><NL><li><a href='frobnick/13.frob.txt'>13.frob.txt</a></li><NL><li><a href='frobnick/14.frob.txt'>14.frob.txt</a></li><NL><li><a href='frobnick/15.frob.txt'>15.frob.txt</a></li><NL><li><a href='frobnick/16.frob.txt'>16.frob.txt</a></li><NL><li><a href='frobnick/17.frob.txt'>17.frob.txt</a></li><NL><li><a href='frobnick/18.frob.txt'>18.frob.txt</a></li><NL><li><a href='frobnick/19.frob.txt'>19.frob.txt</a></li><NL><li><a href='frobnick/20.frob.txt'>20.frob.txt</a></li><NL><li><a href='frobnick/21.frob.txt'>21.frob.txt</a></li><NL><li><a href='frobnick/22.frob.txt'>22.frob.txt</a></li><NL><li><a href='frobnick/23.frob.txt'>23.frob.txt</a></li><NL><li><a href='frobnick/24.frob.txt'>24.frob.txt</a></li><NL><li><a href='frobnick/25.frob.txt'>25.frob.txt</a></li><NL><li><a href='frobnick/26.frob.txt'>26.frob.txt</a></li><NL><li><a href='frobnick/27.frob.txt'>27.frob.txt</a></li><NL><li><a href='frobnick/28.frob.txt'>28.frob.txt</a></li><NL><li><a href='frobnick/29.frob.txt'>29.frob.txt</a></li><NL><li><a href='frobnick/30.frob.txt'>30.frob.txt</a></li><NL><li><a href='frobnick/31.frob.txt'>31.frob.txt</a></li><NL><li><a href='frobnick/32.frob.txt'>32.frob.txt</a></li><NL><li><a href='frobnick/33.frob.txt'>33.frob.txt</a></li><NL><li><a href='frobnick/34.frob.txt'>34.frob.txt</a></li><NL><li><a href='frobnick/35.frob.txt'>35.frob.txt</a></li><NL><li><a href='frobnick/36.frob.txt'>36.frob.txt</a></li><NL><li><a href='frobnick/37.frob.txt'>37.frob.txt</a></li><NL><li><a href='frobnick/38.frob.txt'>38.frob.txt</a></li><NL><li><a href='frobnick/39.frob.txt'>39.frob.txt</a></li><NL><li><a href='frobnick/40.frob.txt'>40.frob.txt</a></li><NL><li><a href='frobnick/41.frob.txt'>41.frob.txt</a></li><NL><li><a href='frobnick/42.frob.txt'>42.frob.txt</a></li><NL><li><a href='frobnick/43.frob.txt'>43.frob.txt</a></li><NL><li><a href='frobnick/44.frob.txt'>44.frob.txt</a></li><NL><li><a href='frobnick/45.frob.txt'>45.frob.txt</a></li><NL><li><a href='frobnick/46.frob.txt'>46.frob.txt</a></li><NL><li><a href='frobnick/47.frob.txt'>47.frob.txt</a></li><NL><li><a href='frobnick/48.frob.txt'>48.frob.txt</a></li><NL><li><a href='frobnick/49.frob.txt'>49.frob.txt</a></li><NL><li><a href='frobnick/50.frob.txt'>50.frob.txt</a></li><NL><li><a href='frobnick/51.frob.txt'>51.frob.txt</a></li><NL><li><a href='frobnick/52.frob.txt'>52.frob.txt</a></li><NL><li><a href='frobnick/53.frob.txt'>53.frob.txt</a></li><NL><li><a href='frobnick/54.frob.txt'>54.frob.txt</a></li><NL><li><a href='frobnick/55.frob.txt'>55.frob.txt</a></li><NL><li><a href='frobnick/56.frob.txt'>56.frob.txt</a></li><NL><li><a href='frobnick/57.frob.txt'>57.frob.txt</a></li><NL><li><a href='frobnick/58.frob.txt'>58.frob.txt</a></li><NL><li><a href='frobnick/59.frob.txt'>59.frob.txt</a></li><NL><li><a href='frobnick/60.frob.txt'>60.frob.txt</a></li><NL><li><a href='frobnick/61.frob.txt'>61.frob.txt</a></li><NL><li><a href='frobnick/62.frob.txt'>62.frob.txt</a></li><NL><li><a href='frobnick/63.frob.txt'>63.frob.txt</a></li><NL><li><a href='frobnick/64.frob.txt'>64.frob.txt</a></li><NL><li><a href='frobnick/65.frob.txt'>65.frob.txt</a></li><NL><li><a href='frobnick/66.frob.txt'>66.frob.txt</a></li><NL><li><a href='frobnick/67.frob.txt'>67.frob.txt</a></li><NL><li><a href='frobnick/68.frob.txt'>68.frob.txt</a></li><NL><li><a href='frobnick/69.frob.txt'>69.frob.txt</a></li><NL><li><a href='frobnick/70.frob.txt'>70.frob.txt</a></li><NL><li><a href='frobnick/71.frob.txt'>71.frob.txt</a></li><NL><li><a href='frobnick/72.frob.txt'>72.frob.txt</a></li><NL><li><a href='frobnick/73.frob.txt'>73.frob.txt</a></li><NL><li><a href='frobnick/74.frob.txt'>74.frob.txt</a></li><NL><li><a href='frobnick/75.frob.txt'>75.frob.txt</a></li><NL><li><a href='frobnick/76.frob.txt'>76.frob.txt</a></li><NL><li><a href='frobnick/77.frob.txt'>77.frob.txt</a></li><NL><li><a href='frobnick/78.frob.txt'>78.frob.txt</a></li><NL><li><a href='frobnick/79.frob.txt'>79.frob.txt</a></li><NL><li><a href='frobnick/80.frob.txt'>80.frob.txt</a></li><NL><li><a href='frobnick/81.frob.txt'>81.frob.txt</a></li><NL><li><a href='frobnick/82.frob.txt'>82.frob.txt</a></li><NL><li><a href='frobnick/83.frob.txt'>83.frob.txt</a></li><NL><li><a href='frobnick/84.frob.txt'>84.frob.txt</a></li><NL><li><a href='frobnick/85.frob.txt'>85.frob.txt</a></li><NL><li><a href='frobnick/86.frob.txt'>86.frob.txt</a></li><NL><li><a href='frobnick/87.frob.txt'>87.frob.txt</a></li><NL><li><a href='frobnick/88.frob.txt'>88.frob.txt</a></li><NL><li><a href='frobnick/89.frob.txt'>89.frob.txt</a></li><NL><li><a href='frobnick/90.frob.txt'>90.frob.txt</a></li><NL><li><a href='frobnick/91.frob.txt'>91.frob.txt</a></li><NL><li><a href='frobnick/92.frob.txt'>92.frob.txt</a></li><NL><li><a href='frobnick/93.frob.txt'>93.frob.txt</a></li><NL><li><a href='frobnick/94.frob.txt'>94.frob.txt</a></li><NL><li><a href='frobnick/95.frob.txt'>95.frob.txt</a></li><NL><li><a href='frobnick/96.frob.txt'>96.frob.txt</a></li><NL><li><a href='frobnick/97.frob.txt'>97.frob.txt</a></li><NL><li><a href='frobnick/98.frob.txt'>98.frob.txt</a></li><NL><li><a href='frobnick/99.frob.txt'>99.frob.txt</a></li><NL><li><a href='frobnick/100.frob.txt'>100.frob.txt</a></li><NL></ul><NL></body><NL></html>,cat index.html
CMBEGIN,Nov 28 12:13:59,/users/lclarkfh,wget http://localhost:8080/frobnic/100,%--2018-11-28 12:13:59--  http://localhost:8080/frobnic/100<NL>Resolving localhost (localhost)... 127.0.0.1<NL>Connecting to localhost (localhost)|127.0.0.1|:8080... connected.<NL>HTTP request sent%% awaiting response... 404 Not Found<NL>2018-11-28 12:13:59 ERROR 404: Not Found.<NL>%,wget http://localhost:8080/frobnic/100
CMBEGIN,,,cd /usr/src/fhttpd,,
CMBEGIN,Nov 28 12:16:43,/usr/src/fhttpd,./webserver.c,./webserver.c: line 1: //: Is a directory<NL>./webserver.c: line 2: //: Is a directory<NL>./webserver.c: line 3: //: Is a directory<NL>./webserver.c: line 4: //: Is a directory<NL>./webserver.c: line 5: //: Is a directory<NL>./webserver.c: line 7: //: Is a directory<NL>./webserver.c: line 8: //: Is a directory<NL>./webserver.c: line 9: //: Is a directory<NL>./webserver.c: line 11: //: Is a directory<NL>./webserver.c: line 12: //: Is a directory<NL>./webserver.c: line 13: //: Is a directory<NL>./webserver.c: line 14: //: Is a directory<NL>./webserver.c: line 15: //: Is a directory<NL>./webserver.c: line 16: //: Is a directory<NL>./webserver.c: line 17: //: Is a directory<NL>./webserver.c: line 18: //: Is a directory<NL>./webserver.c: line 19: //: Is a directory<NL>./webserver.c: line 38: typedef: command not found<NL>./webserver.c: line 39: char: command not found<NL>./webserver.c: line 40: char: command not found<NL>./webserver.c: line 41: char: command not found<NL>./webserver.c: line 42: char: command not found<NL>./webserver.c: line 43: syntax error near unexpected token `}'<NL>./webserver.c: line 43: `} httpreq_t;',./webserver.c
CMBEGIN,Nov 28 12:17:36,/usr/src/fhttpd,wget http://localhost:8080/frobnic/100,,wget http://localhost:8080/frobnic/100
CMBEGIN,,,wget http://localhost:8080/frobnic/100,%--2018-11-28 12:17:36--  http://localhost:8080/frobnic/100<NL>Resolving localhost (localhost)... 127.0.0.1<NL>Connecting to localhost (localhost)|127.0.0.1|:8080... connected.<NL>HTTP request sent%% awaiting response... 404 Not Found<NL>2018-11-28 12:17:36 ERROR 404: Not Found.<NL>%,
CMBEGIN,Nov 28 12:17:38,/usr/src/fhttpd,ls,frobnick  index.html  Makefile<HT>webserver  webserver.c,ls
CMBEGIN,Nov 28 12:17:48,/usr/src/fhttpd,cat webserver.c,%// webserver.c<NL>// FrobozzCo Official Webserver<NL>// Barbazzo Fernap barbazzo@gue.com<NL>// Gustar Woomax gustar@gue.com<NL>// Wilbar Memboob wilbar@gue.com<NL><NL>// By the Frobozz Magic Webserver Company<NL>// Released under the Grue Public License<NL>// Frobruary 14th%% 1067 GUE<NL><NL>// THERE IS NO WARRANTY FOR THE PROGRAM%% TO THE EXTENT PERMITTED<NL>// BY APPLICABLE LAW. EXCEPT WHEN OTHERWISE STATED IN WRITING THE <NL>// COPYRIGHT HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM <C3><CENT>AS IS<C3><CENT> <NL>// WITHOUT WARRANTY OF ANY KIND%% EITHER EXPRESSED OR IMPLIED%% INCLUDING%% <NL>// BUT NOT LIMITED TO%% THE IMPLIED WARRANTIES OF MERCHANTABILITY AND <NL>// FITNESS FOR A PARTICULAR PURPOSE. THE ENTIRE RISK AS TO THE QUALITY <NL>// AND PERFORMANCE OF THE PROGRAM IS WITH YOU. SHOULD THE PROGRAM PROVE <NL>// DEFECTIVE%% *AND IT WILL*%% YOU ASSUME THE COST OF ALL NECESSARY <NL>// SERVICING%% REPAIR OR CORRECTION.<NL><NL>#include <stdio.h><NL>#include <errno.h><NL>#include <string.h><NL>#include <stdlib.h><NL>#include <netdb.h><NL>#include <sys/stat.h><NL>#include <sys/types.h><NL>#include <sys/socket.h><NL>#include <netinet/in.h><NL>#include <arpa/inet.h><NL>#include <unistd.h><NL>#include <fcntl.h><NL>#include <time.h><NL>#include <pthread.h><NL><NL>#define _XOPEN_SOURCE<NL><NL>typedef struct {<NL><HT>char *method;<NL><HT>char *uri;<NL><HT>char *version;<NL><HT>char *headers;<NL>} httpreq_t;<NL><NL><NL>/* NOTE: this function is based on a function provided in the GNU "timegm" man<NL>   page. timegm is a GNU extension to time.h that returns the given tm struct as<NL>   a UNIX timestamp in GMT/UTC%% rather than local time. The man page suggests a<NL>   function similar to the one below as a portable equivalent.<NL> */<NL>time_t my_timegm(struct tm *tm) {<NL><HT>time_t ret;<NL><HT>char *tz;<NL><NL><HT>tz = getenv("TZ");<NL><HT>putenv("TZ=GMT");<NL><HT>tzset();<NL><HT>ret = mktime(tm);<NL><HT>if (tz) {<NL><HT><HT>char envstr[strlen(tz) + 4];<NL><HT><HT>envstr[0] = '\0';<NL><HT><HT>strcat(envstr%% "TZ=");<NL><HT><HT>strcat(envstr%% tz);<NL><HT><HT>putenv(envstr);<NL><HT>} else {<NL><HT><HT>putenv("TZ=");<NL><HT>}<NL><NL><HT>tzset();<NL><NL><HT>return ret;<NL>}<NL><NL>char *get_header(const httpreq_t *req%% const char* headername) {<NL><HT>char *hdrptr;<NL><HT>char *hdrend;<NL><HT>char *retval = NULL;<NL><NL><HT>char searchstr[strlen(headername) + 5];<NL><HT>strcpy(searchstr%% "<NL>");<NL><HT>strcat(searchstr%% headername);<NL><HT>strcat(searchstr%% ": ");<NL><NL><HT>if (hdrptr = strstr(req->headers%% searchstr)) { <NL><HT><HT>hdrptr += strlen(searchstr); <NL><HT><HT>if (hdrend = strstr(hdrptr%% "<NL>")) { <NL><HT><HT><HT>char hdrval[1024]; // temporary return value<NL><HT><HT><HT>memcpy((char *)hdrval%% hdrptr%% (hdrend - hdrptr));<NL><HT><HT><HT>hdrval[hdrend - hdrptr] = '\0'; // tack null onto end of header value<NL><HT><HT><HT>int hdrvallen = strlen(hdrval);<NL><HT><HT><HT>retval = (char *)malloc((hdrvallen + 1) * sizeof(char)); // malloc a space for retval<NL><HT><HT><HT>strcpy(retval%% (char *)hdrval);<NL><HT><HT>} else {<NL><HT><HT><HT>retval = (char *)malloc((strlen(hdrptr) + 1) * sizeof(char)); //<NL><HT><HT><HT>strcpy(retval%% hdrptr);<NL><HT><HT>}<NL><HT>}<NL><NL><HT>return retval;<NL>}<NL><NL>/* As long as str begins with a proper HTTP-Version followed by delim%% returns a<NL>   pointer to the start of the version number (e.g.%% 1.0). Returns NULL otherwise.<NL> */<NL>char *http_version_str(char *str%% char *delim) {<NL><HT>char *vstart = strstr(str%% "HTTP/");<NL><HT>char *vnumstart = str + 5;<NL><HT>char *vdot = strchr(str%% '.');<NL><HT>char *vend = strstr(str%% delim);<NL><HT>char *digits = "0123456789";<NL><HT>int majvlen = 0;<NL><HT>int minvlen = 0;<NL><NL><HT>if (!vstart || !vdot // something's missing<NL><HT><HT>|| vstart != str) // str doesn't start with "HTTP/"<NL><HT><HT>return NULL;<NL><NL><HT>majvlen = strspn(vnumstart%% digits);<NL><HT>minvlen = strspn(vdot + 1%% digits);<NL><NL><HT>if (majvlen < 1 || (vnumstart + majvlen) != vdot // bad major version<NL><HT><HT>|| minvlen < 1 || (vdot + minvlen + 1) != vend) // bad minor version<NL><HT><HT>return NULL;<NL><NL><HT>return vnumstart;<NL>}<NL><NL>/* Fills req with the request data from datastr. Returns 0 on success.<NL> */<NL><NL>int parsereq(httpreq_t *req%% char *datastr) {<NL><HT>char *position;<NL><HT>char *last_position = datastr;<NL><HT>char *temp_position;<NL><HT>int matchlen;<NL><NL><HT>req->method = \"\";<NL><HT>req->uri = \"\";<NL><HT>req->version = \"\";<NL><HT>req->headers = \"\";<NL><NL><HT>if (!(position = strchr(last_position%% ' '))) {<NL><HT><HT>return 1;<NL><HT>}<NL><HT>matchlen = (int)(position - last_position);<NL><HT>req->method = (char *)malloc((matchlen + 1) * sizeof(char));<NL><HT>memcpy(req->method%% last_position%% matchlen);<NL><HT>req->method[matchlen] = '\0';<NL><HT>last_position = position + 1;<NL><NL><HT>if (!(position = strchr(last_position%% ' '))<NL><HT><HT>&& !(position = strstr(last_position%% \"\<NL>\<NL>\"))) {<NL><HT><HT>return 1;<NL><HT>}<NL><NL><HT>// strip any query string out of the URI<NL><HT>if ((temp_position = strchr(last_position%% '?')) && temp_position < position)<NL><HT><HT>matchlen = (int)(temp_position - last_position);<NL><HT>else<NL><HT><HT>matchlen = (int)(position - last_position);<NL><NL><HT>req->uri = (char *)malloc((matchlen + 1) * sizeof(char));<NL><HT>memcpy(req->uri%% last_position%% matchlen);<NL><HT>req->uri[matchlen] = '\0';<NL><HT>if (position[0] == '\<NL>') {<NL><HT><HT>req->version = \"0.9\";<NL><HT><HT>req->headers = \"\";<NL><HT><HT>return 0; // simple req -- uri only<NL><HT>}<NL><NL><HT>// If we get here%% it's a full request%% get the HTTP version and headers<NL><HT>last_position = position + 1;<NL><NL><HT>if (!(position = strstr(last_position%% \"\<NL>\<NL>\"))<NL><HT><HT>|| !(last_position = http_version_str(last_position%% \"\<NL>\<NL>\"))) {<NL><HT><HT>return 1;<NL><HT>}<NL><NL><HT>matchlen = (int)(position - last_position);<NL><HT>req->version = (char *)malloc((matchlen + 1) * sizeof(char));<NL><HT>memcpy(req->version%% last_position%% matchlen);<NL><HT>req->version[matchlen] = '\0';<NL><HT>last_position = position;<NL><NL><HT>req->headers = (char *)malloc(strlen(last_position) * sizeof(char));<NL><HT>strcpy(req->headers%% last_position);<NL><NL><HT>return 0;<NL>} <NL><NL>char *contype(char *ext) {<NL><HT>if (strcmp(ext%% \"html\") == 0) return \"text/html\";<NL><HT>else if (strcmp(ext%% \"htm\") == 0) return \"text/html\";<NL><HT>else if (strcmp(ext%% \"jpeg\") == 0) return \"image/jpeg\";<NL><HT>else if (strcmp(ext%% \"jpg\") == 0) return \"image/jpeg\";<NL><HT>else if (strcmp(ext%% \"gif\") == 0) return \"image/gif\";<NL><HT>else if (strcmp(ext%% \"txt\") == 0) return \"text/plain\";<NL><HT>else return \"application/octet-stream\";<NL><NL>}<NL><NL>char *status(int statcode) {<NL><HT>if (statcode == 200) <HT>return \"200 OK\";<NL><HT>else if (statcode == 304) return \"304 Not Modified\";<NL><HT>else if (statcode == 400) return \"400 Bad Request\";<NL><HT>else if (statcode == 403) return \"403 Forbidden\";<NL><HT>else if (statcode == 404) return \"404 Not Found\";<NL><HT>else if (statcode == 500) return \"500 Internal Server Error\";<NL><HT>else if (statcode == 501) return \"501 Not Implemented\";<NL><HT>else return \"\";<NL>}<NL><NL>int send_response(int sockfd%% httpreq_t *req%% int statcode) {<NL><HT>int urifd;<NL><HT>const int BUFSIZE = 1024;<NL><HT>char sendmessage[BUFSIZE];<NL><HT>char *path = req->uri;<NL><NL><HT>if (req->uri == NULL || req->method == NULL || <NL><HT><HT>req->headers == NULL || req->version == NULL) {<NL><HT><HT>return 0;<NL><HT>}<NL><NL><NL><HT>if ((path[0] == '/') || ((strstr(path%% \"http://\") == path)<NL><HT><HT><HT><HT><HT><HT><HT> && (path = strchr(path + 7%%  '/')))) {<NL><HT><HT>path += 1; // remove leading slash<NL><HT><HT>if (path[0] == '\0') {  // substituting in index.html for a blank URL!<NL><HT><HT><HT>path = \"index.html\";<NL><HT><HT>} else if (path[strlen(path) - 1] == '/') {<NL><HT><HT><HT>//concatenating index.html for a /-terminated URL!<NL><HT><HT><HT>strcat(path%% \"index.html\");    <NL><HT><HT>}<NL><HT>} else {<NL><HT><HT>statcode = 400;<NL><HT>}<NL><NL><HT>if (statcode == 200 && (urifd = open(path%% O_RDONLY%% 0)) < 0) {<NL><HT><HT>if (errno == ENOENT || errno == ENOTDIR) { // file or directory doesn't exist<NL><HT><HT><HT>statcode = 404;<NL><HT><HT>} else if (errno == EACCES) { // access denied<NL><HT><HT><HT>statcode = 403;<NL><HT><HT>} else {<NL><HT><HT><HT>// some other file access problem<NL><HT><HT><HT>statcode = 500;<NL><HT><HT>}<NL><HT>}<NL><NL><HT>if (strstr(path%% \"..\") != NULL) {<NL><HT><HT>statcode = 500;<NL><HT>}<NL><NL><NL><HT>sendmessage[0] = '\0';<NL><HT>if (strcmp(req->version%% \"0.9\") != 0) { // full request<NL><HT><HT>char *ext; // file extension<NL><HT><HT>time_t curtime;<NL><HT><HT>char *imstime;<NL><HT><HT>struct tm tm;<NL><HT><HT>struct stat stbuf;<NL><NL><NL><HT><HT>if (statcode == 200) {<NL><HT><HT><HT>if (ext = strrchr(path%% '.')) ext++; // skip the '.'<NL><HT><HT><HT>else ext = \"\";<NL><HT><HT>} else {<NL><HT><HT><HT>// errors are always html messages<NL><HT><HT><HT>ext = \"html\";<NL><HT><HT>}<NL><NL><HT><HT>// Conditional GET<NL><HT><HT>if ((strcmp(req->method%% \"GET\") == 0)<NL><HT><HT><HT>&& (statcode == 200)<NL><HT><HT><HT>&& (imstime = get_header(req%% \"If-Modified-Since\"))) {<NL><NL><HT><HT><HT>// Get statistics about the requested URI from the local filesystem<NL><HT><HT><HT>if (stat(path%% &stbuf) == -1) {<NL><HT><HT><HT><HT>statcode = 500;<NL><HT><HT><HT>}<NL><NL><HT><HT><HT>if (!strptime(imstime%% \"%%a%% %%d %%b %%Y %%H:%%M:%%S GMT\"%% &tm)<NL><HT><HT><HT><HT>&& !strptime(imstime%% \"%%a%% %%d-%%b-%%y %%H:%%M:%%S GMT\"%% &tm)<NL><HT><HT><HT><HT>&& !strptime(imstime%% \"%%a %%b %%d %%H:%%M:%%S %%Y\"%% &tm)) {<NL><HT><HT><HT><HT>// badly formatted date<NL><HT><HT><HT><HT>statcode = 400;<NL><HT><HT><HT>}<NL><NL><HT><HT><HT>if (stbuf.st_mtime <= my_timegm(&tm)) {<NL><HT><HT><HT><HT>// Not Modified<NL><HT><HT><HT><HT>statcode = 304;<NL><HT><HT><HT>}<NL><HT><HT>}<NL><NL><HT><HT>time(&curtime); // time for Date: header<NL><HT><HT>strcat(sendmessage%% \"HTTP/1.0 \");<NL><HT><HT>strcat(sendmessage%% status(statcode));    <NL><HT><HT>strcat(sendmessage%% \"\<NL>\<NL>Date: \");<NL><HT><HT>strncat(sendmessage%% asctime(gmtime(&curtime))%% 24);<NL><HT><HT>strcat(sendmessage%% \"\<NL>\<NL>Server: Frobozz Magic Software Company Webserver v.002\");<NL><HT><HT>strcat(sendmessage%% \"\<NL>\<NL>Connection: close\");<NL><HT><HT>strcat(sendmessage%% \"\<NL>\<NL>Content-Type: \");    <NL><HT><HT>strcat(sendmessage%% contype(ext));<NL><HT><HT>strcat(sendmessage%% \"\<NL>\<NL>\<NL>\<NL>\");<NL><NL><HT>}<NL><NL><HT>if (statcode != 200) {<NL><HT><HT>strcat(sendmessage%% \"<html><head><title>\");<NL><HT><HT>strcat(sendmessage%% status(statcode));<NL><HT><HT>strcat(sendmessage%% \"</title></head><body><h2>HTTP/1.0</h2><h1>\");<NL><HT><HT>strcat(sendmessage%% status(statcode));<NL><HT><HT>strcat(sendmessage%% \"</h1><h2>URI: \");<NL><HT><HT>strcat(sendmessage%% path);<NL><HT><HT>strcat(sendmessage%% \"</h2></body></html>\");<NL><HT>}<NL><NL><HT>if (sendmessage[0] != '\0') {<NL><HT><HT>// send headers as long as there are headers to send<NL><HT><HT>if (send(sockfd%% sendmessage%% strlen(sendmessage)%% 0) < 0) {<NL><HT><HT><HT>perror(\"send\");<NL><HT><HT><HT>pthread_exit(NULL);<NL><HT><HT>}<NL><HT>}<NL><NL><HT>if (statcode == 200 && (strcmp(req->method%% \"HEAD\") != 0)) {<NL><HT><HT>// send the requested file as long as there's no error and the<NL><HT><HT>// request wasn't just for the headers<NL><HT><HT>int readbytes;<NL><NL><HT><HT>while (readbytes = read(urifd%% sendmessage%% BUFSIZE)) {<NL><HT><HT><HT>if (readbytes < 0) {<NL><HT><HT><HT><HT>perror(\"read\");<NL><HT><HT><HT><HT>pthread_exit(NULL);<NL><HT><HT><HT>}<NL><HT><HT><HT>if (send(sockfd%% sendmessage%% readbytes%% 0) < 0) {<NL><HT><HT><HT><HT>perror(\"send\");<NL><HT><HT><HT><HT>pthread_exit(NULL);<NL><HT><HT><HT>}<NL><HT><HT>}<NL><HT>}<NL>}<NL><NL>void *data_thread(void *sockfd_ptr) {<NL><NL><HT>int sockfd = *(int *) sockfd_ptr;<NL><HT>const int BUFSIZE = 5;<NL><HT>char recvmessage[BUFSIZE];<NL><HT>char *headerstr = NULL;<NL><HT>char *newheaderstr = NULL;<NL><HT>int recvbytes = 0;<NL><HT>int curheadlen = 0;<NL><HT>int totalheadlen = 0;<NL><HT>httpreq_t req;<NL><HT>int statcode = 200;<NL><HT>int done = 0;<NL><HT>int seen_header = 0;<NL><HT>char *header_end;<NL><HT>int content_length = 0;<NL><HT>char *qstr;<NL><NL><HT>free(sockfd_ptr); // we have the int value out of this now<NL><HT>recvmessage[BUFSIZE - 1] = '\0'; // mark end of \"string\"<NL><NL><HT>/* Read incoming client message from the socket */  <NL><HT>while(!done && (recvbytes = recv(sockfd%% recvmessage%% BUFSIZE - 1%% 0))) {<NL><HT><HT>if (recvbytes < 0) {<NL><HT><HT><HT>perror(\"recv\");<NL><HT><HT><HT>pthread_exit(NULL);<NL><HT><HT>}<NL><NL><NL><HT><HT>recvmessage[recvbytes] = '\0';<NL><NL><HT><HT>if (seen_header) {<NL><HT><HT><HT>// getting the entity body<NL><HT><HT><HT>content_length -= recvbytes;<NL><HT><HT><HT>if (content_length <= 0) done = 1;<NL><NL><HT><HT>} else {<NL><NL><HT><HT><HT>newheaderstr = (char *) malloc((totalheadlen + recvbytes + 1) * sizeof(char));<NL><HT><HT><HT>newheaderstr[totalheadlen + recvbytes] = '\0';<NL><HT><HT><HT>memcpy(newheaderstr%% headerstr%% totalheadlen);<NL><HT><HT><HT>memcpy(newheaderstr + totalheadlen%% recvmessage%% recvbytes);<NL><NL><HT><HT><HT>if (headerstr != NULL) {<NL><HT><HT><HT><HT>free(headerstr);<NL><HT><HT><HT>}<NL><NL><HT><HT><HT>headerstr = newheaderstr;<NL><HT><HT><HT>totalheadlen += recvbytes;<NL><NL><HT><HT><HT>header_end = strstr(headerstr%% \"\<NL>\<NL>\<NL>\<NL>\");<NL><NL><HT><HT><HT>if (header_end) {<NL><HT><HT><HT><HT>seen_header = 1;<NL><HT><HT><HT><HT>header_end[2] = '\0';<NL><NL><HT><HT><HT><HT>if (parsereq(&req%% headerstr) != 0) {<NL><HT><HT><HT><HT><HT>statcode = 400;<NL><HT><HT><HT><HT>}<NL><NL><HT><HT><HT><HT>if (strcmp(req.method%% \"POST\") == 0) {<NL><NL><HT><HT><HT><HT><HT>// grab the body length<NL><HT><HT><HT><HT><HT>char *clenstr = get_header(&req%% \"Content-Length\");<NL><NL><HT><HT><HT><HT><HT>if (clenstr) {<NL><NL><HT><HT><HT><HT><HT><HT>content_length = atoi(clenstr) - ((headerstr + totalheadlen) - header_end - 4);<NL><NL><HT><HT><HT><HT><HT><HT>if (content_length <= 0) {<NL><HT><HT><HT><HT><HT><HT><HT>done = 1;<NL><HT><HT><HT><HT><HT><HT>}<NL><NL><HT><HT><HT><HT><HT><HT>free(clenstr);<NL><NL><HT><HT><HT><HT><HT>} else {<NL><NL><HT><HT><HT><HT><HT><HT>statcode = 400; // bad request -- no content length<NL><HT><HT><HT><HT><HT><HT>done = 1;<NL><HT><HT><HT><HT><HT>}<NL><NL><HT><HT><HT><HT>} else {<NL><NL><HT><HT><HT><HT><HT>// This isn't a POST%% so there's no entity body<NL><HT><HT><HT><HT><HT>done = 1;<NL><NL><HT><HT><HT><HT><HT>if (strcmp(req.method%% \"GET\") != 0<NL><HT><HT><HT><HT><HT><HT>&& strcmp(req.method%% \"HEAD\") != 0) {<NL><NL><HT><HT><HT><HT><HT><HT>statcode = 501; // unknown request method<NL><HT><HT><HT><HT><HT>}<NL><NL><HT><HT><HT><HT>}<NL><HT><HT><HT>} // end of \"if (header)end)\"<NL><HT><HT>}<NL><HT>} // end of recv while loop<NL><NL><HT>// used to deref a NULL pointer here... :(<NL><HT>if (headerstr != NULL) {<NL><HT><HT>printf(\"%%s\<NL>\"%% headerstr);<NL><HT><HT>free(headerstr);<NL><HT>}<NL><NL><HT>send_response(sockfd%% &req%% statcode);<NL><HT>close(sockfd);<NL><NL><HT>return NULL;<NL><NL>}<NL><NL>int main(int argc%% char *argv[]) {<NL><HT>int acc%% sockfd%% clen%% port;<NL><HT>struct hostent *he;<NL><HT>struct sockaddr_in caddr%% saddr;<NL><NL><HT>if(argc <= 1) {<NL><NL><HT><HT>fprintf(stderr%% \"No port specified. Exiting!\<NL>\");<NL><HT><HT>exit(1);<NL><NL><HT>}<NL><NL><HT>port = atoi(argv[1]);<NL><NL><HT>/* Obtain name and address for the local host */<NL><HT>if((he=gethostbyname(\"localhost\"))==NULL) {<NL><NL><HT><HT>herror(\"gethostbyname\");<NL><HT><HT>exit(1);<NL><NL><HT>}<NL><NL><HT>/* Open a TCP (Internet Stream) socket */<NL><HT>if((sockfd=socket(AF_INET%%SOCK_STREAM%%0)) == -1) {<NL><NL><HT><HT>perror(\"socket\");<NL><HT><HT>exit(1);<NL><NL><HT>}<NL><NL><HT>/* Create socket address structure for the local host */<NL><HT>memset((char *) &saddr%% '\0'%% sizeof(saddr));<NL><HT>saddr.sin_family=AF_INET;<NL><HT>saddr.sin_port=htons(port);<NL><HT>saddr.sin_addr.s_addr=htonl(INADDR_ANY);<NL><NL><HT>/* Bind our local address so that the client can send to us */<NL><HT>if(bind(sockfd%%(struct sockaddr *) &saddr%%sizeof(saddr)) == -1) {  <NL><HT><HT>perror(\"bind\");<NL><HT><HT>exit(1);<NL><HT>}<NL><NL><HT>if(listen(sockfd%%5) < 0) {<NL><HT><HT>perror(\"listen\");<NL><HT><HT>exit(1);<NL><HT>}<NL><NL><HT>/* Infinite loop for receiving and processing client requests */<NL><HT>for(;;) {<NL><HT><HT>clen=sizeof(caddr);<NL><NL><HT><HT>/* Wait for a connection for a client process */<NL><HT><HT>acc=accept(sockfd%%(struct sockaddr *) &caddr%%(socklen_t*)&clen);<NL><HT><HT>if(acc < 0) {<NL><HT><HT><HT>perror(\"accept\");<NL><HT><HT><HT>exit(1);<NL><HT><HT>} else {<NL><HT><HT><HT>pthread_t *thread = (pthread_t *) malloc(sizeof(pthread_t));<NL><HT><HT><HT>int *sockfd_ptr = (int *) malloc(sizeof(int));<NL><NL><HT><HT><HT>*sockfd_ptr = acc;<NL><HT><HT><HT>pthread_create(thread%% NULL%% data_thread%% sockfd_ptr);<NL><HT><HT>}<NL><HT>}<NL><NL><HT>return 0;<NL>}%,cat webserver.c
CMBEGIN,,,sudo ,%!TRUNCATED TO 500L! <ESC>[?1049h<ESC>[?12;25h<ESC>[?1h<ESC>=<ESC>[H<ESC>[2J<ESC>[54d<ESC>[K<ESC>[?1l<ESC>><ESC>[?12l<ESC>[?25h<ESC>[?1049l<ESC>[39;49m<NL><ESC>[?1049h<ESC>[?12;25h<ESC>[?1h<ESC>=<ESC>[H<ESC>[2J<ESC>[53d<ESC>[?25l<ESC>[30m<ESC>[47m-111:----F1  <ESC>[39;49m<ESC>[1m<ESC>[30m<ESC>[47m*scratch*   <ESC>[0m<ESC>[39;49m<ESC>[30m<ESC>[47m   All L1     (Fundamental) --------------------------------------------------------------------------------------------------------------------------------<ESC>[39;49m<NL><ESC>[A<ESC>[2d<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[54d<ESC>[?25lLoading 00debian-vars...done<ESC>[K<ESC>[H<NL><ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[54;9H<ESC>[?25l/etc/emacs/site-start.d/50autoconf.el (source)...<ESC>[H<NL><ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[54;58H<ESC>[?25ldone<ESC>[H<NL><ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[>0c<ESC>[54d<ESC>[?25lLoading /etc/emacs/site-start.d/50autoconf.el (source)...done<ESC>[K<ESC>[H<ESC>[7mFile Edit Options Buffers Tools Lisp-Interaction Help                                                                                                                                <ESC>[0m<ESC>[39;49m<ESC>[27m<NL><ESC>[A<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[30m<ESC>[48;5;250m-111:----F1  <ESC>[39;49m<ESC>[1m<ESC>[30m<ESC>[48;5;250m*scratch*   <ESC>[0m<ESC>[39;49m<ESC>[30m<ESC>[48;5;250m   All L1     (Lisp Interaction) ---------------------------------------------------------------------------------------------------------------------------<ESC>[39;49m<NL><ESC>[A<ESC>[2d<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[54d<ESC>[?25lFor information about GNU Emacs and the GNU system%% type C-h C-a.<ESC>[H<NL><ESC>[?12l<ESC>[?25h<ESC>[?12;25h<BEL><ESC>[54d<ESC>[?25lBeginning of buffer<ESC>[K<ESC>[H<ESC>[7mFile Edit Options Buffers Tools C Help                                                                                                                                               <ESC>[0m<ESC>[39;49m<ESC>[27m<NL><ESC>[A<NL><ESC>[38;5;124m// webserver.c                                                                                                                                                                       <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m// FrobozzCo Official Webserver                                                                                                                                                      <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m// Barbazzo Fernap barbazzo@gue.com                                                                                                                                                  <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m// Gustar Woomax gustar@gue.com                                                                                                                                                      <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m// Wilbar Memboob wilbar@gue.com                                                                                                                                                     <ESC>[39;49m<NL><ESC>[A<NL><ESC>[K<NL><ESC>[38;5;124m// By the Frobozz Magic Webserver Company                                                                                                                                            <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m// Released under the Grue Public License                                                                                                                                            <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m// Frobruary 14th%% 1067 GUE                                                                                                                                                          <ESC>[39;49m<NL><ESC>[A<NL><ESC>[K<NL><ESC>[38;5;124m// THERE IS NO WARRANTY FOR THE PROGRAM%% TO THE EXTENT PERMITTED                                                                                                                     <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m// BY APPLICABLE LAW. EXCEPT WHEN OTHERWISE STATED IN WRITING THE                                                                                                                    <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m// COPYRIGHT HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM <ESC>[39;49m<ESC>[4m<ESC>[38;5;124m\u201C<ESC>[0m<ESC>[39;49m<ESC>[38;5;124mAS IS<ESC>[39;49m<ESC>[4m<ESC>[38;5;124m\u201D<ESC>[0m<ESC>[39;49m<ESC>[38;5;124m                                                                                                      <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m// WITHOUT WARRANTY OF ANY KIND%% EITHER EXPRESSED OR IMPLIED%% INCLUDING%%                                                                                                             <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m// BUT NOT LIMITED TO%% THE IMPLIED WARRANTIES OF MERCHANTABILITY AND                                                                                                                 <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m// FITNESS FOR A PARTICULAR PURPOSE. THE ENTIRE RISK AS TO THE QUALITY                                                                                                               <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m// AND PERFORMANCE OF THE PROGRAM IS WITH YOU. SHOULD THE PROGRAM PROVE                                                                                                              <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m// DEFECTIVE%% *AND IT WILL*%% YOU ASSUME THE COST OF ALL NECESSARY                                                                                                                    <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m// SERVICING%% REPAIR OR CORRECTION.                                                                                                                                                  <ESC>[39;49m<NL><ESC>[A<NL><ESC>[K<NL><ESC>[38;5;60m#include<ESC>[39;49m <ESC>[38;5;89m<stdio.h><ESC>[39;49m<ESC>[K<NL><ESC>[38;5;60m#include<ESC>[39;49m <ESC>[38;5;89m<errno.h><ESC>[39;49m<ESC>[K<NL><ESC>[38;5;60m#include<ESC>[39;49m <ESC>[38;5;89m<string.h><ESC>[39;49m<ESC>[K<NL><ESC>[38;5;60m#include<ESC>[39;49m <ESC>[38;5;89m<stdlib.h><ESC>[39;49m<ESC>[K<NL><ESC>[38;5;60m#include<ESC>[39;49m <ESC>[38;5;89m<netdb.h><ESC>[39;49m<ESC>[K<NL><ESC>[38;5;60m#include<ESC>[39;49m <ESC>[38;5;89m<sys/stat.h><ESC>[39;49m<ESC>[K<NL><ESC>[38;5;60m#include<ESC>[39;49m <ESC>[38;5;89m<sys/types.h><ESC>[39;49m<ESC>[K<NL><ESC>[38;5;60m#include<ESC>[39;49m <ESC>[38;5;89m<sys/socket.h><ESC>[39;49m<ESC>[K<NL><ESC>[38;5;60m#include<ESC>[39;49m <ESC>[38;5;89m<netinet/in.h><ESC>[39;49m<ESC>[K<NL><ESC>[38;5;60m#include<ESC>[39;49m <ESC>[38;5;89m<arpa/inet.h><ESC>[39;49m<ESC>[K<NL><ESC>[38;5;60m#include<ESC>[39;49m <ESC>[38;5;89m<unistd.h><ESC>[39;49m<ESC>[K<NL><ESC>[38;5;60m#include<ESC>[39;49m <ESC>[38;5;89m<fcntl.h><ESC>[39;49m<ESC>[K<NL><ESC>[38;5;60m#include<ESC>[39;49m <ESC>[38;5;89m<time.h><ESC>[39;49m<ESC>[K<NL><ESC>[38;5;60m#include<ESC>[39;49m <ESC>[38;5;89m<pthread.h><ESC>[39;49m<ESC>[K<NL><ESC>[K<NL><ESC>[38;5;60m#define<ESC>[39;49m <ESC>[38;5;130m_XOPEN_SOURCE<ESC>[39;49m<ESC>[K<NL><ESC>[K<NL><ESC>[38;5;129mtypedef<ESC>[39;49m <ESC>[38;5;129mstruct<ESC>[39;49m {<ESC>[K<NL>        <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mmethod<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130muri<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mversion<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mheaders<ESC>[39;49m;<ESC>[K<NL>} <ESC>[38;5;28mhttpreq_t<ESC>[39;49m;<ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[38;5;124m/* NOTE: this function is based on a function provided in the GNU "timegm" man                                                                                                       <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m   page. timegm is a GNU extension to time.h that returns the given tm struct as                                                                                                     <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m   a UNIX timestamp in GMT/UTC%% rather than local time. The man page suggests a                                                                                                      <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m   function similar to the one below as a portable equivalent.                                                                                                                       <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m */<ESC>[39;49m<ESC>[K<NL><ESC>[38;5;28mtime_t<ESC>[39;49m <ESC>[38;5;21mmy_timegm<ESC>[39;49m(<ESC>[38;5;129mstruct<ESC>[39;49m <ESC>[38;5;28mtm<ESC>[39;49m *<ESC>[38;5;130mtm<ESC>[39;49m) {<ESC>[K<NL><ESC>[30m<ESC>[48;5;250m-11U:----F1  <ESC>[39;49m<ESC>[1m<ESC>[30m<ESC>[48;5;250mwebserver.c <ESC>[0m<ESC>[39;49m<ESC>[30m<ESC>[48;5;250m   Top L1     (C/l Abbrev) ---------------------------------------------------------------------------------------------------------------------------------<ESC>[39;49m<NL><ESC>[A<ESC>[2d<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[54d<ESC>[K<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m2<ESC>[39;49m<ESC>[H<NL><NL><ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m3<ESC>[39;49m<ESC>[4;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m4<ESC>[39;49m<ESC>[5;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m5<ESC>[39;49m<ESC>[6;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m6<ESC>[39;49m<ESC>[7;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m7<ESC>[39;49m<ESC>[8;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m8<ESC>[39;49m<ESC>[9;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m9<ESC>[39;49m<ESC>[10;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m10<ESC>[39;49m<ESC>[11;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m1<ESC>[39;49m<ESC>[12;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m2<ESC>[39;49m<ESC>[13;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m4<ESC>[39;49m<ESC>[15;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m5<ESC>[39;49m<ESC>[16;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m7<ESC>[39;49m<ESC>[18;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m9<ESC>[39;49m<ESC>[20;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m22<ESC>[39;49m<ESC>[23;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m4<ESC>[39;49m<ESC>[25;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m7<ESC>[39;49m<ESC>[28;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m9<ESC>[39;49m<ESC>[30;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m31<ESC>[39;49m<ESC>[32;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m3<ESC>[39;49m<ESC>[34;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m5<ESC>[39;49m<ESC>[36;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m7<ESC>[39;49m<ESC>[38;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m9<ESC>[39;49m<ESC>[40;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m41<ESC>[39;49m<ESC>[42;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m3<ESC>[39;49m<ESC>[44;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m4<ESC>[39;49m<ESC>[45;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m5<ESC>[39;49m<ESC>[46;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m7<ESC>[39;49m<ESC>[48;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m9<ESC>[39;49m<ESC>[50;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[1;52r<ESC>[2;1H<ESC>[26M<ESC>[1;54r<ESC>[27;1H<ESC>[?25l        <ESC>[38;5;28mtime_t<ESC>[39;49m <ESC>[38;5;130mret<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mtz<ESC>[39;49m;<ESC>[K<NL><ESC>[K<NL>        tz = getenv(<ESC>[38;5;89m"TZ"<ESC>[39;49m);<ESC>[K<NL>        putenv(<ESC>[38;5;89m"TZ=GMT"<ESC>[39;49m);<ESC>[K<NL>        tzset();<ESC>[K<NL>        ret = mktime(tm);<ESC>[K<NL>        <ESC>[38;5;129mif<ESC>[39;49m (tz) {<ESC>[K<NL>                <ESC>[38;5;28mchar<ESC>[39;49m <ESC>[38;5;130menvstr<ESC>[39;49m[strlen(tz) + 4];<ESC>[K<NL>                envstr[0] = <ESC>[38;5;89m'\0'<ESC>[39;49m;<ESC>[K<NL>                strcat(envstr%% <ESC>[38;5;89m"TZ="<ESC>[39;49m);<ESC>[K<NL>                strcat(envstr%% tz);<ESC>[K<NL>                putenv(envstr);<ESC>[K<NL>        } <ESC>[38;5;129melse<ESC>[39;49m {<ESC>[K<NL>                putenv(<ESC>[38;5;89m"TZ="<ESC>[39;49m);<ESC>[K<NL>        }<ESC>[K<NL><ESC>[K<NL>        tzset();<ESC>[K<NL><ESC>[K<NL>        <ESC>[38;5;129mreturn<ESC>[39;49m ret;<ESC>[K<NL>}<ESC>[K<NL><BS><ESC>[K<NL><ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;21mget_header<ESC>[39;49m(<ESC>[38;5;129mconst<ESC>[39;49m <ESC>[38;5;28mhttpreq_t<ESC>[39;49m *<ESC>[38;5;130mreq<ESC>[39;49m%% <ESC>[38;5;129mconst<ESC>[39;49m <ESC>[38;5;28mchar<ESC>[39;49m* <ESC>[38;5;130mheadername<ESC>[39;49m) {<ESC>[K<NL>        <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mhdrptr<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mhdrend<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mretval<ESC>[39;49m = <ESC>[38;5;30mNULL<ESC>[39;49m;<ESC>[K<NL><ESC>[30m<ESC>[48;5;250m 8%% L52<ESC>[39;49m<ESC>[27;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m5<ESC>[39;49m<ESC>[30;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m8<ESC>[39;49m<ESC>[33;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m61<ESC>[39;49m<ESC>[36;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m4<ESC>[39;49m<ESC>[39;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m7<ESC>[39;49m<ESC>[42;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m70<ESC>[39;49m<ESC>[45;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m3<ESC>[39;49m<ESC>[48;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m5<ESC>[39;49m<ESC>[50;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m7<ESC>[39;49m<NL><ESC>[A<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[1;52r<ESC>[3;1H<ESC>[27M<ESC>[1;54r<ESC>[2;1H<ESC>[K<ESC>[26d<ESC>[K<NL><ESC>[?25l        <ESC>[38;5;28mchar<ESC>[39;49m <ESC>[38;5;130msearchstr<ESC>[39;49m[strlen(headername) + 5];<ESC>[K<NL>        strcpy(searchstr%% <ESC>[38;5;89m"<NL>"<ESC>[39;49m);<ESC>[K<NL>        strcat(searchstr%% headername);<ESC>[K<NL>        strcat(searchstr%% <ESC>[38;5;89m": "<ESC>[39;49m);<ESC>[K<NL><ESC>[K<NL>        <ESC>[38;5;129mif<ESC>[39;49m (hdrptr = strstr(req->headers%% searchstr)) {<ESC>[K<NL>                hdrptr += strlen(searchstr);<ESC>[K<NL>                <ESC>[38;5;129mif<ESC>[39;49m (hdrend = strstr(hdrptr%% <ESC>[38;5;89m"<NL>"<ESC>[39;49m)) {<ESC>[K<NL>                        <ESC>[38;5;28mchar<ESC>[39;49m <ESC>[38;5;130mhdrval<ESC>[39;49m[1024]; <ESC>[38;5;124m// temporary return value                                                                                                                 <ESC>[39;49m<NL><ESC>[A<NL>                        memcpy((<ESC>[38;5;28mchar<ESC>[39;49m *)hdrval%% hdrptr%% (hdrend - hdrptr));<ESC>[K<NL>                        hdrval[hdrend - hdrptr] = <ESC>[38;5;89m'\0'<ESC>[39;49m; <ESC>[38;5;124m// tack null onto end of header value                                                                                        <ESC>[39;49m<NL><ESC>[A<NL>                        <ESC>[38;5;28mint<ESC>[39;49m <ESC>[38;5;130mhdrvallen<ESC>[39;49m = strlen(hdrval);<ESC>[K<NL>                        retval = (<ESC>[38;5;28mchar<ESC>[39;49m *)malloc((hdrvallen + 1) * <ESC>[38;5;129msizeof<ESC>[39;49m(<ESC>[38;5;28mchar<ESC>[39;49m)); <ESC>[38;5;124m// malloc a space for retval                                                                        <ESC>[39;49m<NL><ESC>[A<NL>                        strcpy(retval%% (<ESC>[38;5;28mchar<ESC>[39;49m *)hdrval);<ESC>[K<NL>                } <ESC>[38;5;129melse<ESC>[39;49m {<ESC>[K<NL>                        retval = (<ESC>[38;5;28mchar<ESC>[39;49m *)malloc((strlen(hdrptr) + 1) * <ESC>[38;5;129msizeof<ESC>[39;49m(<ESC>[38;5;28mchar<ESC>[39;49m)); <ESC>[38;5;124m//                                                                                             <ESC>[39;49m<NL><ESC>[A<NL>                        strcpy(retval%% hdrptr);<ESC>[K<NL>                }<ESC>[K<NL>        }<ESC>[K<NL><ESC>[K<NL>        <ESC>[38;5;129mreturn<ESC>[39;49m retval;<ESC>[K<NL>}<ESC>[K<NL><BS><ESC>[K<NL><ESC>[38;5;124m/* As long as str begins with a proper HTTP-Version followed by delim%% returns a                                                                                                     <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m   pointer to the start of the version number (e.g.%% 1.0). Returns NULL otherwise.                                                                                                   <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m */<ESC>[39;49m<ESC>[K<ESC>[53;29H<ESC>[30m<ESC>[48;5;250m13%% L79<ESC>[39;49m<ESC>[27;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m83<ESC>[39;49m<ESC>[31;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m4<ESC>[39;49m<ESC>[32;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m5<ESC>[39;49m<ESC>[33;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m6<ESC>[39;49m<ESC>[34;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m91<ESC>[39;49m<ESC>[39;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m3<ESC>[39;49m<ESC>[41;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m5<ESC>[39;49m<ESC>[43;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m6<ESC>[39;49m<ESC>[44;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m7<ESC>[39;49m<ESC>[45;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m9<ESC>[39;49m<ESC>[47;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m100<ESC>[39;49m<ESC>[48;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m2<ESC>[39;49m<ESC>[50;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m3<ESC>[39;49m<ESC>[51;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[1;52r<ESC>[2;1H<ESC>[26M<ESC>[1;54r<ESC>[27;1H<ESC>[?25l<ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;21mhttp_version_str<ESC>[39;49m(<ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mstr<ESC>[39;49m%% <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mdelim<ESC>[39;49m) {<ESC>[K<NL>        <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mvstart<ESC>[39;49m = strstr(str%% <ESC>[38;5;89m"HTTP/"<ESC>[39;49m);<ESC>[K<NL>        <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mvnumstart<ESC>[39;49m = str + 5;<ESC>[K<NL>        <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mvdot<ESC>[39;49m = strchr(str%% <ESC>[38;5;89m'.'<ESC>[39;49m);<ESC>[K<NL>        <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mvend<ESC>[39;49m = strstr(str%% delim);<ESC>[K<NL>        <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mdigits<ESC>[39;49m = <ESC>[38;5;89m"0123456789"<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;28mint<ESC>[39;49m <ESC>[38;5;130mmajvlen<ESC>[39;49m = 0;<ESC>[K<NL>        <ESC>[38;5;28mint<ESC>[39;49m <ESC>[38;5;130mminvlen<ESC>[39;49m = 0;<ESC>[K<NL><ESC>[K<NL>        <ESC>[38;5;129mif<ESC>[39;49m (!vstart || !vdot <ESC>[38;5;124m// something's missing                                                                                                                                  <ESC>[39;49m<NL><ESC>[A<NL>                || vstart != str) <ESC>[38;5;124m// str doesn't start with "HTTP/"                                                                                                                  <ESC>[39;49m<NL><ESC>[A<NL>                <ESC>[38;5;129mreturn<ESC>[39;49m <ESC>[38;5;30mNULL<ESC>[39;49m;<ESC>[K<NL><ESC>[K<NL>        majvlen = strspn(vnumstart%% digits);<ESC>[K<NL>        minvlen = strspn(vdot + 1%% digits);<ESC>[K<NL><ESC>[K<NL>        <ESC>[38;5;129mif<ESC>[39;49m (majvlen < 1 || (vnumstart + majvlen) != vdot <ESC>[38;5;124m// bad major version                                                                                                        <ESC>[39;49m<NL><ESC>[A<NL>                || minvlen < 1 || (vdot + minvlen + 1) != vend) <ESC>[38;5;124m// bad minor version                                                                                                 <ESC>[39;49m<NL><ESC>[A<NL>                <ESC>[38;5;129mreturn<ESC>[39;49m <ESC>[38;5;30mNULL<ESC>[39;49m;<ESC>[K<NL><ESC>[K<NL>        <ESC>[38;5;129mreturn<ESC>[39;49m vnumstart;<ESC>[K<NL>}<ESC>[K<NL><BS><ESC>[K<NL><ESC>[38;5;124m/* Fills req with the request data from datastr. Returns 0 on success.                                                                                                               <ESC>[39;49m<NL><ESC>[A<NL><ESC>[38;5;124m */<ESC>[39;49m<ESC>[K<NL><ESC>[K<ESC>[53;30H<ESC>[30m<ESC>[48;5;250m6%% L105<ESC>[39;49m<ESC>[27;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m6<ESC>[39;49m<ESC>[28;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m7<ESC>[39;49m<ESC>[29;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m9<ESC>[39;49m<ESC>[31;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m11<ESC>[39;49m<ESC>[33;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m2<ESC>[39;49m<ESC>[34;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m3<ESC>[39;49m<ESC>[35;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m5<ESC>[39;49m<ESC>[37;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m6<ESC>[39;49m<ESC>[38;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m7<ESC>[39;49m<ESC>[39;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m8<ESC>[39;49m<ESC>[40;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m9<ESC>[39;49m<ESC>[41;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m20<ESC>[39;49m<ESC>[42;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m1<ESC>[39;49m<ESC>[43;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m2<ESC>[39;49m<ESC>[44;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m3<ESC>[39;49m<ESC>[45;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m4<ESC>[39;49m<ESC>[46;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m5<ESC>[39;49m<ESC>[47;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m6<ESC>[39;49m<ESC>[48;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m7<ESC>[39;49m<ESC>[49;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m8<ESC>[39;49m<ESC>[50;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m9<ESC>[39;49m<ESC>[51;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m30<ESC>[39;49m<NL><ESC>[A<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[1;51r<ESC>[2;1H<ESC>[26M<ESC>[1;54r<ESC>[26;1H<ESC>[K<NL><ESC>[?25l<ESC>[38;5;28mint<ESC>[39;49m <ESC>[38;5;21mparsereq<ESC>[39;49m(<ESC>[38;5;28mhttpreq_t<ESC>[39;49m *<ESC>[38;5;130mreq<ESC>[39;49m%% <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mdatastr<ESC>[39;49m) {<ESC>[K<NL>        <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mposition<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mlast_position<ESC>[39;49m = datastr;<ESC>[K<NL>        <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mtemp_position<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;28mint<ESC>[39;49m <ESC>[38;5;130mmatchlen<ESC>[39;49m;<ESC>[K<NL><ESC>[K<NL>        req->method = <ESC>[38;5;89m""<ESC>[39;49m;<ESC>[K<NL>        req->uri = <ESC>[38;5;89m""<ESC>[39;49m;<ESC>[K<NL>        req->version = <ESC>[38;5;89m""<ESC>[39;49m;<ESC>[K<NL>        req->headers = <ESC>[38;5;89m""<ESC>[39;49m;<ESC>[K<NL><ESC>[K<NL>        <ESC>[38;5;129mif<ESC>[39;49m (!(position = strchr(last_position%% <ESC>[38;5;89m' '<ESC>[39;49m))) {<ESC>[K<NL>                <ESC>[38;5;129mreturn<ESC>[39;49m 1;<ESC>[K<NL>        }<ESC>[K<NL>        matchlen = (<ESC>[38;5;28mint<ESC>[39;49m)(position - last_position);<ESC>[K<NL>        req->method = (<ESC>[38;5;28mchar<ESC>[39;49m *)malloc((matchlen + 1) * <ESC>[38;5;129msizeof<ESC>[39;49m(<ESC>[38;5;28mchar<ESC>[39;49m));<ESC>[K<NL>        memcpy(req->method%% last_position%% matchlen);<ESC>[K<NL>        req->method[matchlen] = <ESC>[38;5;89m'\0'<ESC>[39;49m;<ESC>[K<NL>        last_position = position + 1;<ESC>[K<NL><ESC>[K<NL>        <ESC>[38;5;129mif<ESC>[39;49m (!(position = strchr(last_position%% <ESC>[38;5;89m' '<ESC>[39;49m))<ESC>[K<NL>                && !(position = strstr(last_position%% <ESC>[38;5;89m"<NL>"<ESC>[39;49m))) {<ESC>[K<NL>                <ESC>[38;5;129mreturn<ESC>[39;49m 1;<ESC>[K<NL>        }<ESC>[K<NL><ESC>[K<NL><HT><ESC>[38;5;124m// strip any query string out of the URI                                                                                                                                     <ESC>[39;49m<NL><ESC>[53;29H<ESC>[30m<ESC>[48;5;250m23%% L131<ESC>[39;49m<ESC>[27;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m3<ESC>[39;49m<ESC>[29;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m4<ESC>[39;49m<ESC>[30;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m5<ESC>[39;49m<ESC>[31;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m6<ESC>[39;49m<ESC>[32;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m7<ESC>[39;49m<ESC>[33;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m9<ESC>[39;49m<ESC>[35;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m40<ESC>[39;49m<ESC>[36;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m2<ESC>[39;49m<ESC>[38;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m5<ESC>[39;49m<ESC>[41;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m8<ESC>[39;49m<ESC>[44;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m51<ESC>[39;49m<ESC>[47;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m3<ESC>[39;49m<ESC>[49;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m5<ESC>[39;49m<ESC>[51;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m6<ESC>[39;49m<NL><ESC>[A<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[1;52r<ESC>[2;1H<ESC>[31M<ESC>[1;54r<ESC>[22;1H<ESC>[?25l        <ESC>[38;5;129mif<ESC>[39;49m ((temp_position = strchr(last_position%% <ESC>[38;5;89m'?'<ESC>[39;49m)) && temp_position < position)<ESC>[K<NL>                matchlen = (<ESC>[38;5;28mint<ESC>[39;49m)(temp_position - last_position);<ESC>[K<NL>        <ESC>[38;5;129melse<ESC>[39;49m<ESC>[K<NL>                matchlen = (<ESC>[38;5;28mint<ESC>[39;49m)(position - last_position);<ESC>[K<NL><ESC>[K<NL>        req->uri = (<ESC>[38;5;28mchar<ESC>[39;49m *)malloc((matchlen + 1) * <ESC>[38;5;129msizeof<ESC>[39;49m(<ESC>[38;5;28mchar<ESC>[39;49m));<ESC>[K<NL>        memcpy(req->uri%% last_position%% matchlen);<ESC>[K<NL>        req->uri[matchlen] = <ESC>[38;5;89m'\0'<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;129mif<ESC>[39;49m (position[0] == <ESC>[38;5;89m'<NL>'<ESC>[39;49m) {<ESC>[K<NL>                req->version = <ESC>[38;5;89m"0.9"<ESC>[39;49m;<ESC>[K<NL>                req->headers = <ESC>[38;5;89m""<ESC>[39;49m;<ESC>[K<NL>                <ESC>[38;5;129mreturn<ESC>[39;49m 0; <ESC>[38;5;124m// simple req -- uri only                                                                                                                                  <ESC>[39;49m<NL><ESC>[A<NL>        }<ESC>[K<NL><ESC>[K<NL>        <ESC>[38;5;124m// If we get here%% it's a full request%% get the HTTP version and headers                                                                                                     <ESC>[39;49m<NL><ESC>[A<NL>        last_position = position + 1;<ESC>[K<NL><ESC>[K<NL>        <ESC>[38;5;129mif<ESC>[39;49m (!(position = strstr(last_position%% <ESC>[38;5;89m"<NL>"<ESC>[39;49m))<ESC>[K<NL>                || !(last_position = http_version_str(last_position%% <ESC>[38;5;89m"<NL>"<ESC>[39;49m))) {<ESC>[K<NL>                <ESC>[38;5;129mreturn<ESC>[39;49m 1;<ESC>[K<NL>        }<ESC>[K<NL><ESC>[K<NL>        matchlen = (<ESC>[38;5;28mint<ESC>[39;49m)(position - last_position);<ESC>[K<NL>        req->version = (<ESC>[38;5;28mchar<ESC>[39;49m *)malloc((matchlen + 1) * <ESC>[38;5;129msizeof<ESC>[39;49m(<ESC>[38;5;28mchar<ESC>[39;49m));<ESC>[K<NL>        memcpy(req->version%% last_position%% matchlen);<ESC>[K<NL>        req->version[matchlen] = <ESC>[38;5;89m'\0'<ESC>[39;49m;<ESC>[K<NL>        last_position = position;<ESC>[K<NL><ESC>[K<NL>        req->headers = (<ESC>[38;5;28mchar<ESC>[39;49m *)malloc(strlen(last_position) * <ESC>[38;5;129msizeof<ESC>[39;49m(<ESC>[38;5;28mchar<ESC>[39;49m));<ESC>[K<NL>        strcpy(req->headers%% last_position);<ESC>[K<NL><ESC>[K<ESC>[53;30H<ESC>[30m<ESC>[48;5;250m9%% L162<ESC>[39;49m<ESC>[27;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m74<ESC>[39;49m<ESC>[39;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m80<ESC>[39;49m<ESC>[45;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m1<ESC>[39;49m<ESC>[46;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m3<ESC>[39;49m<ESC>[48;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m5<ESC>[39;49m<ESC>[50;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[1;51r<ESC>[2;1H<ESC>[28M<ESC>[1;54r<ESC>[24;1H<ESC>[K<NL><ESC>[?25l        <ESC>[38;5;129mreturn<ESC>[39;49m 0;<ESC>[K<NL>}<ESC>[K<NL><BS><ESC>[K<NL><ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;21mcontype<ESC>[39;49m(<ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mext<ESC>[39;49m) {<ESC>[K<NL>        <ESC>[38;5;129mif<ESC>[39;49m (strcmp(ext%% <ESC>[38;5;89m"html"<ESC>[39;49m) == 0) <ESC>[38;5;129mreturn<ESC>[39;49m <ESC>[38;5;89m"text/html"<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;129melse<ESC>[39;49m <ESC>[38;5;129mif<ESC>[39;49m (strcmp(ext%% <ESC>[38;5;89m"htm"<ESC>[39;49m) == 0) <ESC>[38;5;129mreturn<ESC>[39;49m <ESC>[38;5;89m"text/html"<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;129melse<ESC>[39;49m <ESC>[38;5;129mif<ESC>[39;49m (strcmp(ext%% <ESC>[38;5;89m"jpeg"<ESC>[39;49m) == 0) <ESC>[38;5;129mreturn<ESC>[39;49m <ESC>[38;5;89m"image/jpeg"<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;129melse<ESC>[39;49m <ESC>[38;5;129mif<ESC>[39;49m (strcmp(ext%% <ESC>[38;5;89m"jpg"<ESC>[39;49m) == 0) <ESC>[38;5;129mreturn<ESC>[39;49m <ESC>[38;5;89m"image/jpeg"<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;129melse<ESC>[39;49m <ESC>[38;5;129mif<ESC>[39;49m (strcmp(ext%% <ESC>[38;5;89m"gif"<ESC>[39;49m) == 0) <ESC>[38;5;129mreturn<ESC>[39;49m <ESC>[38;5;89m"image/gif"<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;129melse<ESC>[39;49m <ESC>[38;5;129mif<ESC>[39;49m (strcmp(ext%% <ESC>[38;5;89m"txt"<ESC>[39;49m) == 0) <ESC>[38;5;129mreturn<ESC>[39;49m <ESC>[38;5;89m"text/plain"<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;129melse<ESC>[39;49m <ESC>[38;5;129mreturn<ESC>[39;49m <ESC>[38;5;89m"application/octet-stream"<ESC>[39;49m;<ESC>[K<NL><ESC>[K<NL>}<ESC>[K<NL><BS><ESC>[K<NL><ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;21mstatus<ESC>[39;49m(<ESC>[38;5;28mint<ESC>[39;49m <ESC>[38;5;130mstatcode<ESC>[39;49m) {<ESC>[K<NL>        <ESC>[38;5;129mif<ESC>[39;49m (statcode == 200)    <ESC>[38;5;129mreturn<ESC>[39;49m <ESC>[38;5;89m"200 OK"<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;129melse<ESC>[39;49m <ESC>[38;5;129mif<ESC>[39;49m (statcode == 304) <ESC>[38;5;129mreturn<ESC>[39;49m <ESC>[38;5;89m"304 Not Modified"<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;129melse<ESC>[39;49m <ESC>[38;5;129mif<ESC>[39;49m (statcode == 400) <ESC>[38;5;129mreturn<ESC>[39;49m <ESC>[38;5;89m"400 Bad Request"<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;129melse<ESC>[39;49m <ESC>[38;5;129mif<ESC>[39;49m (statcode == 403) <ESC>[38;5;129mreturn<ESC>[39;49m <ESC>[38;5;89m"403 Forbidden"<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;129melse<ESC>[39;49m <ESC>[38;5;129mif<ESC>[39;49m (statcode == 404) <ESC>[38;5;129mreturn<ESC>[39;49m <ESC>[38;5;89m"404 Not Found"<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;129melse<ESC>[39;49m <ESC>[38;5;129mif<ESC>[39;49m (statcode == 500) <ESC>[38;5;129mreturn<ESC>[39;49m <ESC>[38;5;89m"500 Internal Server Error"<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;129melse<ESC>[39;49m <ESC>[38;5;129mif<ESC>[39;49m (statcode == 501) <ESC>[38;5;129mreturn<ESC>[39;49m <ESC>[38;5;89m"501 Not Implemented"<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;129melse<ESC>[39;49m <ESC>[38;5;129mreturn<ESC>[39;49m <ESC>[38;5;89m""<ESC>[39;49m;<ESC>[K<NL>}<ESC>[K<NL><BS><ESC>[K<NL><ESC>[38;5;28mint<ESC>[39;49m <ESC>[38;5;21msend_response<ESC>[39;49m(<ESC>[38;5;28mint<ESC>[39;49m <ESC>[38;5;130msockfd<ESC>[39;49m%% <ESC>[38;5;28mhttpreq_t<ESC>[39;49m *<ESC>[38;5;130mreq<ESC>[39;49m%% <ESC>[38;5;28mint<ESC>[39;49m <ESC>[38;5;130mstatcode<ESC>[39;49m) {<ESC>[K<NL>        <ESC>[38;5;28mint<ESC>[39;49m <ESC>[38;5;130murifd<ESC>[39;49m;<ESC>[K<NL><HT><ESC>[38;5;129mconst<ESC>[39;49m <ESC>[38;5;28mint<ESC>[39;49m <ESC>[38;5;130mBUFSIZE<ESC>[39;49m = 1024;<NL><BS><BS><BS><BS><BS><ESC>[30m<ESC>[48;5;250m35%% L190<ESC>[39;49m<ESC>[27;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m20<ESC>[39;49m<ESC>[37;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m4<ESC>[39;49m<ESC>[41;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m8<ESC>[39;49m<ESC>[45;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m12<ESC>[39;49m<ESC>[49;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[1;52r<ESC>[2;1H<ESC>[26M<ESC>[1;54r<ESC>[27;1H<ESC>[?25l        <ESC>[38;5;28mchar<ESC>[39;49m <ESC>[38;5;130msendmessage<ESC>[39;49m[BUFSIZE];<ESC>[K<NL>        <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mpath<ESC>[39;49m = req->uri;<ESC>[K<NL><ESC>[K<NL>        <ESC>[38;5;129mif<ESC>[39;49m (req->uri == <ESC>[38;5;30mNULL<ESC>[39;49m || req->method == <ESC>[38;5;30mNULL<ESC>[39;49m ||<ESC>[K<NL>                req->headers == <ESC>[38;5;30mNULL<ESC>[39;49m || req->version == <ESC>[38;5;30mNULL<ESC>[39;49m) {<ESC>[K<NL>                <ESC>[38;5;129mreturn<ESC>[39;49m 0;<ESC>[K<NL>        }<ESC>[K<NL><ESC>[K<NL><ESC>[K<NL>        <ESC>[38;5;129mif<ESC>[39;49m ((path[0] == <ESC>[38;5;89m'/'<ESC>[39;49m) || ((strstr(path%% <ESC>[38;5;89m"http://"<ESC>[39;49m) == path)<ESC>[K<NL>                                                         && (path = strchr(path + 7%%  <ESC>[38;5;89m'/'<ESC>[39;49m)))) {<ESC>[K<NL>                path += 1; <ESC>[38;5;124m// remove leading slash                                                                                                                                   <ESC>[39;49m<NL><ESC>[A<NL>                <ESC>[38;5;129mif<ESC>[39;49m (path[0] == <ESC>[38;5;89m'\0'<ESC>[39;49m) {  <ESC>[38;5;124m// substituting in index.html for a blank URL!                                                                                               <ESC>[39;49m<NL><ESC>[A<NL>                        path = <ESC>[38;5;89m"index.html"<ESC>[39;49m;<ESC>[K<NL>                } <ESC>[38;5;129melse<ESC>[39;49m <ESC>[38;5;129mif<ESC>[39;49m (path[strlen(path) - 1] == <ESC>[38;5;89m'/'<ESC>[39;49m) {<ESC>[K<NL>                        <ESC>[38;5;124m//concatenating index.html for a /-terminated URL!                                                                                                           <ESC>[39;49m<NL><ESC>[A<NL>                        strcat(path%% <ESC>[38;5;89m"index.html"<ESC>[39;49m);<ESC>[K<NL>                }<ESC>[K<NL>        } <ESC>[38;5;129melse<ESC>[39;49m {<ESC>[K<NL>                statcode = 400;<ESC>[K<NL>        }<ESC>[K<NL><ESC>[K<NL>        <ESC>[38;5;129mif<ESC>[39;49m (statcode == 200 && (urifd = open(path%% O_RDONLY%% 0)) < 0) {<ESC>[K<NL>                <ESC>[38;5;129mif<ESC>[39;49m (errno == ENOENT || errno == ENOTDIR) { <ESC>[38;5;124m// file or directory doesn't exist                                                                                        <ESC>[39;49m<NL><ESC>[A<NL>                        statcode = 404;<ESC>[K<NL>                } <ESC>[38;5;129melse<ESC>[39;49m <ESC>[38;5;129mif<ESC>[39;49m (errno == EACCES) { <ESC>[38;5;124m// access denied                                                                                                                       <ESC>[39;49m<NL><ESC>[A<ESC>[53;29H<ESC>[30m<ESC>[48;5;250m40%% L216<ESC>[39;49m<ESC>[27;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m28<ESC>[39;49m<ESC>[39;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m30<ESC>[39;49m<ESC>[41;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m1<ESC>[39;49m<ESC>[42;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m2<ESC>[39;49m<ESC>[43;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m4<ESC>[39;49m<ESC>[45;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m6<ESC>[39;49m<ESC>[47;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m8<ESC>[39;49m<ESC>[49;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m40<ESC>[39;49m<ESC>[51;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m1<ESC>[39;49m<NL><ESC>[A<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[1;52r<ESC>[2;1H<ESC>[26M<ESC>[1;54r<ESC>[27;1H<ESC>[?25l                        statcode = 403;<ESC>[K<NL>                } <ESC>[38;5;129melse<ESC>[39;49m {<ESC>[K<NL>                        <ESC>[38;5;124m// some other file access problem                                                                                                                            <ESC>[39;49m<NL><ESC>[A<NL>                        statcode = 500;<ESC>[K<NL>                }<ESC>[K<NL>        }<ESC>[K<NL><ESC>[K<NL>        <ESC>[38;5;129mif<ESC>[39;49m (strstr(path%% <ESC>[38;5;89m".."<ESC>[39;49m) != <ESC>[38;5;30mNULL<ESC>[39;49m) {<ESC>[K<NL>                statcode = 500;<ESC>[K<NL>        }<ESC>[K<NL><ESC>[K<NL><ESC>[K<NL>        sendmessage[0] = <ESC>[38;5;89m'\0'<ESC>[39;49m;<ESC>[K<NL>        <ESC>[38;5;129mif<ESC>[39;49m (strcmp(req->version%% <ESC>[38;5;89m"0.9"<ESC>[39;49m) != 0) { <ESC>[38;5;124m// full request                                                                                                                      <ESC>[39;49m<NL><ESC>[A<NL>                <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mext<ESC>[39;49m; <ESC>[38;5;124m// file extension                                                                                                                                         <ESC>[39;49m<NL><ESC>[A<NL>                <ESC>[38;5;28mtime_t<ESC>[39;49m <ESC>[38;5;130mcurtime<ESC>[39;49m;<ESC>[K<NL>                <ESC>[38;5;28mchar<ESC>[39;49m *<ESC>[38;5;130mimstime<ESC>[39;49m;<ESC>[K<NL>                <ESC>[38;5;129mstruct<ESC>[39;49m <ESC>[38;5;28mtm<ESC>[39;49m <ESC>[38;5;130mtm<ESC>[39;49m;<ESC>[K<NL>                <ESC>[38;5;129mstruct<ESC>[39;49m <ESC>[38;5;28mstat<ESC>[39;49m <ESC>[38;5;130mstbuf<ESC>[39;49m;<ESC>[K<NL><ESC>[K<NL><ESC>[K<NL>                <ESC>[38;5;129mif<ESC>[39;49m (statcode == 200) {<ESC>[K<NL>                        <ESC>[38;5;129mif<ESC>[39;49m (ext = strrchr(path%% <ESC>[38;5;89m'.'<ESC>[39;49m)) ext++; <ESC>[38;5;124m// skip the '.'                                                                                                         <ESC>[39;49m<NL><ESC>[A<NL>                        <ESC>[38;5;129melse<ESC>[39;49m ext = <ESC>[38;5;89m""<ESC>[39;49m;<ESC>[K<NL>                } <ESC>[38;5;129melse<ESC>[39;49m {<ESC>[K<NL>                        <ESC>[38;5;124m// errors are always html messages                                                                                                                           <ESC>[39;49m<NL><ESC>[A<ESC>[53;30H<ESC>[30m<ESC>[48;5;250m7%% L242<ESC>[39;49m<ESC>[27;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m3<ESC>[39;49m<ESC>[28;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m4<ESC>[39;49m<ESC>[29;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m5<ESC>[39;49m<ESC>[30;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m6<ESC>[39;49m<ESC>[31;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m7<ESC>[39;49m<ESC>[32;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m8<ESC>[39;49m<ESC>[33;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m9<ESC>[39;49m<ESC>[34;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m50<ESC>[39;49m<ESC>[35;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m1<ESC>[39;49m<ESC>[36;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m2<ESC>[39;49m<ESC>[37;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m3<ESC>[39;49m<ESC>[38;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m5<ESC>[39;49m<ESC>[40;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m7<ESC>[39;49m<ESC>[42;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m8<ESC>[39;49m<ESC>[43;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m9<ESC>[39;49m<ESC>[44;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m61<ESC>[39;49m<ESC>[46;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m2<ESC>[39;49m<ESC>[47;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m4<ESC>[39;49m<ESC>[49;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m6<ESC>[39;49m<ESC>[51;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[1;52r<ESC>[2;1H<ESC>[28M<ESC>[1;54r<ESC>[25;1H<ESC>[?25l                        ext = <ESC>[38;5;89m"html"<ESC>[39;49m;<ESC>[K<NL>                }<ESC>[K<NL><ESC>[K<NL>                <ESC>[38;5;124m// Conditional GET                                                                                                                                                   <ESC>[39;49m<NL><ESC>[A<NL>                <ESC>[38;5;129mif<ESC>[39;49m ((strcmp(req->method%% <ESC>[38;5;89m"GET"<ESC>[39;49m) == 0)<ESC>[K<NL>                        && (statcode == 200)<ESC>[K<NL>                        && (imstime = get_header(req%% <ESC>[38;5;89m"If-Modified-Since"<ESC>[39;49m))) {<ESC>[K<NL><ESC>[K<NL>                        <ESC>[38;5;124m// Get statistics about the requested URI from the local filesystem                                                                                          <ESC>[39;49m<NL><ESC>[A<NL>                        <ESC>[38;5;129mif<ESC>[39;49m (stat(path%% &stbuf) == -1) {<ESC>[K<NL>                                statcode = 500;<ESC>[K<NL>                        }<ESC>[K<NL><ESC>[K<NL>                        <ESC>[38;5;129mif<ESC>[39;49m (!strptime(imstime%% <ESC>[38;5;89m"%%a%% %%d %%b %%Y %%H:%%M:%%S GMT"<ESC>[39;49m%% &tm)<ESC>[K<NL>                                && !strptime(imstime%% <ESC>[38;5;89m"%%a%% %%d-%%b-%%y %%H:%%M:%%S GMT"<ESC>[39;49m%% &tm)<ESC>[K<NL>                                && !strptime(imstime%% <ESC>[38;5;89m"%%a %%b %%d %%H:%%M:%%S %%Y"<ESC>[39;49m%% &tm)) {<ESC>[K<NL>                                <ESC>[38;5;124m// badly formatted date                                                                                                                              <ESC>[39;49m<NL><ESC>[A<NL>                                statcode = 400;<ESC>[K<NL>                        }<ESC>[K<NL><ESC>[K<NL>                        <ESC>[38;5;129mif<ESC>[39;49m (stbuf.st_mtime <= my_timegm(&tm)) {<ESC>[K<NL>                                <ESC>[38;5;124m// Not Modified                                                                                                                                      <ESC>[39;49m<NL><ESC>[A<NL>                                statcode = 304;<ESC>[K<NL>                        }<ESC>[K<NL>                }<ESC>[K<NL><ESC>[K<NL>                time(&curtime); <ESC>[38;5;124m// time for Date: header                                                                                                                             <ESC>[39;49m<NL><ESC>[A<NL>                strcat(sendmessage%% <ESC>[38;5;89m"HTTP/1.0 "<ESC>[39;49m);<ESC>[K<ESC>[53;29H<ESC>[30m<ESC>[48;5;250m53%% L270<ESC>[39;49m<ESC>[27;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m9<ESC>[39;49m<ESC>[47;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m2<ESC>[39;49m<ESC>[49;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[1;52r<ESC>[2;1H<ESC>[26M<ESC>[1;54r<ESC>[27;1H<ESC>[?25l                strcat(sendmessage%% status(statcode));<ESC>[K<NL>                strcat(sendmessage%% <ESC>[38;5;89m"<NL>Date: "<ESC>[39;49m);<ESC>[K<NL>                strncat(sendmessage%% asctime(gmtime(&curtime))%% 24);<ESC>[K<NL>                strcat(sendmessage%% <ESC>[38;5;89m"<NL>Server: Frobozz Magic Software Company Webserver v.002"<ESC>[39;49m);<ESC>[K<NL>                strcat(sendmessage%% <ESC>[38;5;89m"<NL>Connection: close"<ESC>[39;49m);<ESC>[K<NL>                strcat(sendmessage%% <ESC>[38;5;89m"<NL>Content-Type: "<ESC>[39;49m);<ESC>[K<NL>                strcat(sendmessage%% contype(ext));<ESC>[K<NL>                strcat(sendmessage%% <ESC>[38;5;89m"<NL><NL>"<ESC>[39;49m);<ESC>[K<NL><ESC>[K<NL>        }<ESC>[K<NL><ESC>[K<NL>        <ESC>[38;5;129mif<ESC>[39;49m (statcode != 200) {<ESC>[K<NL>                strcat(sendmessage%% <ESC>[38;5;89m"<html><head><title>"<ESC>[39;49m);<ESC>[K<NL>                strcat(sendmessage%% status(statcode));<ESC>[K<NL>                strcat(sendmessage%% <ESC>[38;5;89m"</title></head><body><h2>HTTP/1.0</h2><h1>"<ESC>[39;49m);<ESC>[K<NL>                strcat(sendmessage%% status(statcode));<ESC>[K<NL>                strcat(sendmessage%% <ESC>[38;5;89m"</h1><h2>URI: "<ESC>[39;49m);<ESC>[K<NL>                strcat(sendmessage%% path);<ESC>[K<NL>                strcat(sendmessage%% <ESC>[38;5;89m"</h2></body></html>"<ESC>[39;49m);<ESC>[K<NL>        }<ESC>[K<NL><ESC>[K<NL>        <ESC>[38;5;129mif<ESC>[39;49m (sendmessage[0] != <ESC>[38;5;89m'\0'<ESC>[39;49m) {<ESC>[K<NL>                <ESC>[38;5;124m// send headers as long as there are headers to send                                                                                                                 <ESC>[39;49m<NL><ESC>[A<NL>                <ESC>[38;5;129mif<ESC>[39;49m (send(sockfd%% sendmessage%% strlen(sendmessage)%% 0) < 0) {<ESC>[K<NL>                        perror(<ESC>[38;5;89m"send"<ESC>[39;49m);<ESC>[K<NL>                        pthread_exit(<ESC>[38;5;30mNULL<ESC>[39;49m);<ESC>[K<ESC>[53;30H<ESC>[30m<ESC>[48;5;250m7%% L296<ESC>[39;49m<ESC>[27;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<BEL><BEL><ESC>[54d<ESC>[?25lEnd of buffer<ESC>[H<NL><HT><ESC>[38;5;129mif<ESC>[39;49m(listen(sockfd%%5) < 0) {<ESC>[K<NL><HT><HT>perror(<ESC>[38;5;89m"listen"<ESC>[39;49m);<ESC>[K<NL><HT><HT>exit(1);<ESC>[K<NL><HT>}<ESC>[K<NL><NL><BS><ESC>[38;5;124m/* Infinite loop for receiving and processing client requests */<ESC>[39;49m<ESC>[K<NL><HT><ESC>[38;5;129mfor<ESC>[39;49m(;;) {<ESC>[K<NL><BS>clen=<ESC>[38;5;129msizeof<ESC>[39;49m(caddr);<ESC>[K<NL><ESC>[K<NL><HT><HT><ESC>[38;5;124m/* Wait for a connection for a client process */<ESC>[39;49m<NL><HT><HT>acc=accept(sockfd%%(<ESC>[38;5;129mstruct<ESC>[39;49m <ESC>[38;5;28msockaddr<ESC>[39;49m *) &caddr%%(<ESC>[38;5;28msocklen_t<ESC>[39;49m*)&clen);<NL><HT><HT><ESC>[38;5;129mif<ESC>[39;49m(acc < 0) {<ESC>[K<NL><HT><HT><HT>perror(<ESC>[38;5;89m"accept"<ESC>[39;49m);<ESC>[K<NL><HT><HT><HT>exit(1);<ESC>[K<NL><HT><HT>} <ESC>[38;5;129melse<ESC>[39;49m {<ESC>[K<NL><ESC>[38;5;28mpthread_t<ESC>[39;49m *<ESC>[38;5;130mthread<ESC>[39;49m = (<ESC>[38;5;28mpthread_t<ESC>[39;49m *) malloc(<ESC>[38;5;129msizeof<ESC>[39;49m(pthread_t));<NL><HT><HT><HT><ESC>[38;5;28mint<ESC>[39;49m *<ESC>[38;5;130msockfd_ptr<ESC>[39;49m = (<ESC>[38;5;28mint<ESC>[39;49m *) malloc(<ESC>[38;5;129msizeof<ESC>[39;49m(<ESC>[38;5;28mint<ESC>[39;49m));<NL><ESC>[K<NL><HT><HT><HT>*sockfd_ptr = acc;<ESC>[K<NL><HT><HT><HT>pthread_create(thread%% <ESC>[38;5;30mNULL<ESC>[39;49m%% data_thread%% sockfd_ptr);<NL><HT><HT><ESC>[8P<NL><HT><ESC>[8P<NL><NL><ESC>[38;5;129mreturn<ESC>[39;49m 0;<ESC>[K<NL>}<ESC>[K<NL><BS><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><NL><ESC>[K<NL><NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<NL><ESC>[K<ESC>[53;29H<ESC>[30m<ESC>[48;5;250mBot L520<ESC>[39;49m<ESC>[27;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><ESC>[54d<ESC>[K<ESC>[27d<ESC>[?25lq<ESC>[53;6H<ESC>[30m<ESC>[48;5;250m**<ESC>[39;49m<ESC>[27;2H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<BEL><ESC>[54;1H<ESC>[?25lEnd of buffer<ESC>[27;2H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><BEL><ESC>[54;1H<ESC>[K<ESC>[27d<ESC>[K<BEL><ESC>[54d<ESC>[?25lThe mark is not set now%% so there is no region<ESC>[27;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[54d<ESC>[K<ESC>[27d<BEL><ESC>[54d<ESC>[?25lThe mark is not set now%% so there is no region<ESC>[27;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[54d<ESC>[K<ESC>[27d<ESC>[?25lq<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[?25lu<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[?25li<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[?25lt<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m1<ESC>[39;49m<ESC>[28;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m0<ESC>[39;49m<ESC>[27;5H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<BS><ESC>[K<BS><ESC>[K<BS><ESC>[K<BS><ESC>[K<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m19<ESC>[39;49m<ESC>[26;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m8<ESC>[39;49m<ESC>[25;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m7<ESC>[39;49m<ESC>[24;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m6<ESC>[39;49m<ESC>[23;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[54d<ESC>[?25lAuto-saving...<ESC>[23;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[54;15H<ESC>[?25ldone<ESC>[23;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[54d<ESC>[K<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m2<ESC>[39;49m<ESC>[19;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;35H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m07<ESC>[39;49m<ESC>[14;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m2<ESC>[39;49m<ESC>[9;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;34H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m497<ESC>[39;49m<ESC>[4;1H<ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[53;36H<ESC>[?25l<ESC>[30m<ESC>[48;5;250m5<ESC>[39;49m<ESC>[H<NL><ESC>[?12l<ESC>[?25h<ESC>[?12;25h<ESC>[1;52r<ESC>[2;1H<ESC>[27L<ESC>[1;54r<ESC>[2;1H<ESC>[?25l        <ESC>[38;5;129mif<ESC>[39;49m((he=gethostbyname(<ESC>[38;5;89m"localhost"<ESC>[39;49m))==<ESC>[38;5;30mNULL<ESC>[39;49m) {<ESC>[K<NL><ESC>[K%,
